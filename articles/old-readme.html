<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="STDataMGMT">
<title>old-readme • STDataMGMT</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="old-readme">
<meta property="og:description" content="STDataMGMT">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">STDataMGMT</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/country_specific_dataprep.html">country_specific_dataprep</a>
    <a class="dropdown-item" href="../articles/examples.html">run_synthetic_workflow</a>
    <a class="dropdown-item" href="../articles/old-readme.html">old-readme</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/maurolepore/STDataMGMT/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>old-readme</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/maurolepore/STDataMGMT/blob/HEAD/vignettes/articles/old-readme.Rmd" class="external-link"><code>vignettes/articles/old-readme.Rmd</code></a></small>
      <div class="d-none name"><code>old-readme.Rmd</code></div>
    </div>

    
    
<h1>
ST input dataframes structure <span style="float: left;">
<a href="https://github.com/2DegreesInvesting/r2dii.climate.stress.test" class="external-link">
<img src="https://cinea.ec.europa.eu/sites/default/files/styles/oe_theme_medium_no_crop/public/2021-01/life_1.jpg?itok=J1KQ12Nw" align="right" style="height: 43px; padding-right: 10px;"><img src="https://imgur.com/A5ASZPE.png" align="right" style="height: 43px;"></a> </span>
</h1>
<p>The repository forms part of the LIFE STRESS project. The LIFE STRESS
project has received funding from the LIFE Programme of the European
Union. The contents of this publication are the sole responsibility of
Theia Finance Labs and do not necessarily reflect the opinion of the
European Union. Project: 101074271 — LIFE21-GIC-DE-Stress.</p>
<p>The preprocessing functions included in this repo have for purpose to
generate dataframes to use as an input of the climate stress testing
tool TRISK available on this repository :</p>
<p>TRISK input dataframes follow this structure :</p>
<p><img src="reference/figures/outputs_diagram.jpg"></p>
<div class="section level2">
<h2 id="stdatamgmt">STDataMGMT<a class="anchor" aria-label="anchor" href="#stdatamgmt"></a>
</h2>
<p>The goal of STDataMGMT is to provide the input data required for the
stress test that cannot be shared as part of a public repository. The
2DII stress test needs several external data inputs that usually require
a license which prohibits redistributing the data. 2DII does not have
the right to publicly share that data though, which is why this
repository needs to stay private.The repository will be used to point
the main stress testing code to, when said data needs to be loaded. This
allows publishing the code containing 2DII’s main climate stress testing
methodology open source.</p>
<p>The underlying logic of the data preparation is the following
quintet:</p>
<ol style="list-style-type: decimal">
<li><p>raw data are stored with the affix <strong>raw_</strong> in the
data-raw folder</p></li>
<li><p>in the R folder the data preparation function is stored with the
affix <strong>prepare_/aggregate_</strong></p></li>
<li><p>in the data-raw folder the file that calls the data preparation
function is stored with the affix <strong>run_</strong></p></li>
<li><p>prepared data are stored in the data-raw folder without
affix</p></li>
<li><p>in the test folder the test of the data preparation function is
stored with the affix <strong>test_</strong></p></li>
</ol>
<div class="section level3">
<h3 id="using-the-repository">Using the repository<a class="anchor" aria-label="anchor" href="#using-the-repository"></a>
</h3>
<ul>
<li>To generate all stress test input files, create the required inputs
in <code>data-raw/DBs</code>, then run the
<code>data-raw/run_workflow.R</code> file and retrieve the newly
generated files in <code>data-raw</code> .</li>
<li>An example usage of the preprocessing functions using synthetic data
can be found in <code>vignettes/run_synthetic_workflow.Rmd</code>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="inputs-dataframes-structure">Inputs Dataframes Structure<a class="anchor" aria-label="anchor" href="#inputs-dataframes-structure"></a>
</h3>
<div class="section level4">
<h4 id="db_ids-parquet">DB_ids.parquet<a class="anchor" aria-label="anchor" href="#db_ids-parquet"></a>
</h4>
<ul>
<li>generated by:
<ul>
<li>data_raw/prep_datalake.R</li>
</ul>
</li>
<li>description:
<ul>
<li>Contains the matching between IDs of different sources.</li>
</ul>
</li>
<li>unique index :
<ul>
<li>isin</li>
<li>company_id</li>
</ul>
</li>
<li>columns:
<ul>
<li>isin: ISIN of a company. Multiple ISINs can match the same
company_id. Can be NA if and only if company_id is not NA</li>
<li>company_name: name of the company. Unique for each company_id</li>
<li>company_id: id of a company. can be NA if and only if isin is not
NA</li>
</ul>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="db_assets_eikon-parquet">DB_assets_eikon.parquet<a class="anchor" aria-label="anchor" href="#db_assets_eikon-parquet"></a>
</h4>
<ul>
<li>generated by:
<ul>
<li>data_raw/prep_datalake.R</li>
</ul>
</li>
<li>description:
<ul>
<li>Contains financial features for different ISINs.</li>
</ul>
</li>
<li>unique index:
<ul>
<li>isin</li>
</ul>
</li>
<li>columns:
<ul>
<li>isin: ISIN of company</li>
<li>ald_sector: location of the asset, in ISO2c format. Can be obtained
from the first 2 characters of the ISIN.</li>
<li>net_profit_margin: net profit margin (between 0 and 1)</li>
<li>pd: probability of default of an asset (between 0 and 1)</li>
<li>debt_equity_ratio : debt equity ratio of an asset (between 0 and
1)</li>
<li>volatility: volatility of an asset (between 0 and 1)</li>
<li>asset_drift: drift of an asset (between 0 and 1)</li>
</ul>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="db_company_activities-parquet">DB_company_activities.parquet<a class="anchor" aria-label="anchor" href="#db_company_activities-parquet"></a>
</h4>
<ul>
<li>generated by:
<ul>
<li>data_raw/prep_datalake.R</li>
</ul>
</li>
<li>description:
<ul>
<li>contains the production information for each company</li>
</ul>
</li>
<li>unique index:
<ul>
<li>company_id</li>
<li>ald_sector</li>
<li>ald_business_unit</li>
<li>ald_location</li>
</ul>
</li>
<li>columns:
<ul>
<li>company_id: id of the company</li>
<li>ald_sector: sector of the asset (ex: Power, Oil&amp;Gas.. ) see
<code>STDataMgmt::production_types$ald_sector</code> for all possible
values</li>
<li>ald_business_unit: business unit of the asset (ex: RenewablesCap,
OilCap) see <code>STDataMgmt::production_types$ald_business_unit</code>
for all possible values.</li>
<li>ald_location: country where is located the asset, in ISO2c
format</li>
<li>activity_unit: unit of the production (ex: MW, GJ, …) see
<code>STDataMgmt::production_types$ald_production_unit</code> for all
possible values.</li>
<li>Equity Ownership YYYY : amount of production for a given year. 1
column per year.</li>
</ul>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="db_company_emissions-parquet">DB_company_emissions.parquet<a class="anchor" aria-label="anchor" href="#db_company_emissions-parquet"></a>
</h4>
<ul>
<li>generated by:
<ul>
<li>data_raw/prep_datalake.R</li>
</ul>
</li>
<li>description:
<ul>
<li>contains the emissions information for each company</li>
</ul>
</li>
<li>unique index:
<ul>
<li>company_id</li>
<li>ald_sector</li>
<li>ald_business_unit</li>
<li>ald_location</li>
</ul>
</li>
<li>columns:
<ul>
<li>company_id: id of the company</li>
<li>ald_sector: sector of the asset (ex: Power, Oil&amp;Gas.. ) see
<code>STDataMgmt::production_types$ald_sector</code> for all possible
values</li>
<li>ald_business_unit: business unit of the asset (ex: RenewablesCap,
OilCap) see <code>STDataMgmt::production_types$ald_business_unit</code>
for all possible values.</li>
<li>ald_location: country where is located the asset, in ISO2c
format</li>
<li>activity_unit: unit of the production (ex: tCO2, tCO2e) see
<code>STDataMgmt::production_types$emissions_factor_unit</code> for all
possible values.</li>
<li>Equity Ownership YYYY : amount of emissions for a given year. 1
column per year.</li>
</ul>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="db_ownership_tree-parquet">DB_ownership_tree.parquet<a class="anchor" aria-label="anchor" href="#db_ownership_tree-parquet"></a>
</h4>
<ul>
<li>generated by:
<ul>
<li>data_raw/prep_datalake.R</li>
</ul>
</li>
<li>description:
<ul>
<li>Contains the linking information between companies, parent and
subsidiaries.</li>
</ul>
</li>
<li>unique index:
<ul>
<li>parent_company_id</li>
<li>subsidiary_company_id</li>
</ul>
</li>
<li>columns:
<ul>
<li>parent_company_id: the parent company_id</li>
<li>subsidiary_company_id: the subsidiary company_id</li>
<li>ownership_level: rank of the subsidiary towards the parent company.
If equal to 0, then parent_company_id == subsidiary_company_id. If equal
to 1, then the parent company is the highest parent of this
subsidiary.</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="outputs-dataframes-structure">Outputs Dataframes Structure<a class="anchor" aria-label="anchor" href="#outputs-dataframes-structure"></a>
</h3>
<div class="section level4">
<h4 id="prewrangled_financial_data_stress_test-csv">prewrangled_financial_data_stress_test.csv<a class="anchor" aria-label="anchor" href="#prewrangled_financial_data_stress_test-csv"></a>
</h4>
<ul>
<li>generated by :
<ul>
<li>data-raw/run_prepare_prewrangled_financial_data_stress_test.R</li>
</ul>
</li>
<li>description:
<ul>
<li>Financial data input for the stress test.</li>
</ul>
</li>
<li>unique index:
<ul>
<li>company_id</li>
</ul>
</li>
<li>columns:
<ul>
<li>company_id: the company id</li>
<li>pd: the probability of default</li>
<li>net_profit_margin: the net profit margin of a company</li>
<li>debt_equity_ratio: the debt equity ratio of a company</li>
<li>volatility: the volatility of a company</li>
<li>asset_drift: the asset drift of a company</li>
<li>net_profit_margin_rawdata_ratio : the ratio between financial
indicators coming from the raw input data, and how many came from
averages. The final indicator of a company can be mixed, as it can be an
aggregate of indicators from multiple countries if a company owns assets
in different countries.</li>
<li>debt_equity_ratio_rawdata_ratio: idem for debt_equity_ratio</li>
<li>volatility_rawdata_ratio: idem for volatiliy</li>
<li>asset_drift_rawdata_ratio: idem for asset_drift</li>
</ul>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="abcd_stress_test_input-csv">abcd_stress_test_input.csv<a class="anchor" aria-label="anchor" href="#abcd_stress_test_input-csv"></a>
</h4>
<ul>
<li>generated by :
<ul>
<li>data-raw/run_prepare_abcd_tress_test_input.R</li>
</ul>
</li>
<li>description :
<ul>
<li>production and emissions factor for different companies. An asset
here refers to the eventual aggregation of the production and emissions
of multiple ISINs from the raw company data (DB_company_activities and
DB_company_emissions)</li>
</ul>
</li>
<li>unique index:
<ul>
<li>company_id</li>
<li>ald_sector</li>
<li>ald_business_unit</li>
<li>scenario_geography</li>
<li>year</li>
</ul>
</li>
<li>columns:
<ul>
<li>company_id: id of the company</li>
<li>company_name: name of the company</li>
<li>ald_sector: sector of the asset</li>
<li>ald_business_unit: business unit of the asset</li>
<li>scenario_geography: scenario geography of the asset</li>
<li>year: year of production</li>
<li>ald_production_unit: production unit of the asset</li>
<li>emissions_factor_unit: unit of the emission factor</li>
<li>plan_tech_prod: production in the ald_sector/ald_business_unit, for
a given year</li>
<li>plan_emission_factor: emission in the ald_sector/ald_business_unit,
for a given year</li>
<li>plan_sec_prod: production in the ald_sector, for a given year</li>
</ul>
</li>
</ul>
<!-- badges: start --><!-- badges: end -->
</div>
</div>
<div class="section level3">
<h3 id="prepare_data-r---functions-for-data-preparation">prepare_data.R - Functions for data preparation<a class="anchor" aria-label="anchor" href="#prepare_data-r---functions-for-data-preparation"></a>
</h3>
<div class="section level4">
<h4 id="preparation-of-scenario-data">Preparation of scenario data<a class="anchor" aria-label="anchor" href="#preparation-of-scenario-data"></a>
</h4>
<p>In order to get the scenario data into the required format as defined
in <code>r2dii.climate.stress.test</code>, the function
<code><a href="../reference/prepare_scenario_data.html">prepare_scenario_data()</a></code> assumes that input in the format of
data found on the dropbox under <strong><em>Processed Data</em></strong>
is available. The input argument should point to a corresponding file.
The start year of the scenario file must be defined, as does the output
directory (NOT the file name). Please do not write the output data to
any directory in this repository, unless you are specifically tasked
with updating the default auxiliary files for the 2DII stress test.</p>
<p><strong>ADD INFO ON PACTA ROUTINE ONCE CLEAR</strong></p>
</div>
<div class="section level4">
<h4 id="preparation-of-production-data">Preparation of production data<a class="anchor" aria-label="anchor" href="#preparation-of-production-data"></a>
</h4>
<p>Production data preparation uses the PAMS dataset from Asset
Resolution as an input, which is stored on the dropbox under
<strong><em>ST_INPUTS_PRODUCTION</em></strong>. Start year, as well as
time-horizon, scenario sources, and sectors are defined manually.Data
are aggregated to company, technology, geography and year level and
production as well as emission factors are retained.</p>
<p>We remove entries with faulty or missing ownership information and
sectors that we cannot cover in the stress test as of now. Entries with
missing information on ALD locations are removed as well.For all entries
that have missing emission factors, we mean impute based on the
corresponding combination of country, technology, year or sub region,
technology, year.</p>
</div>
<div class="section level4">
<h4 id="preparation-of-capacity-data">Preparation of capacity data<a class="anchor" aria-label="anchor" href="#preparation-of-capacity-data"></a>
</h4>
<p>The function
<code>prepare_prewrangled_capacity_factors_WEOYYYY()</code> reads in raw
power generation and capacity data and wrangles that data into the
required format for usage in <code>r2dii.climate.stress.test</code>. It
uses input files that are to be found on the dropbpox under
<strong>Raw_Data</strong>, under <code>WEOYYYY_Raw_Data.csv</code>, with
YYYY being the year of the release of the report.The user furthermore
has to set a start year and an end year of the preparation time frame.
The start year should correspond with the year of publication and the
end year should be the same as the one used in
<code>r2dii.climate.stress.test</code>.</p>
<p>Beside wrangling the data into the expected format in terms of
pivoting and renaming columns, the function will linearly interpolate
missing values between the start and end years of the preparation time
frame for power generation and capacity. It will transform both
indicators into the same unit (GW) and calculate capacity factors per
scenario, scenario geography, sector, technology and year. It also
ensures the sector/technology breakdown is the same as in
<code>r2dii.climate.stess.test</code>, as long as the input file is an
IEA WEO release.</p>
<p>Lastly, the directory to which the resulting file will be written has
to be set. By default, the function will not overwrite any file within
this repository. So if you are trying to update the contents of the
repository, you will have to do that explicitly.</p>
</div>
<div class="section level4">
<h4 id="preparation-of-price-data">Preparation of price data<a class="anchor" aria-label="anchor" href="#preparation-of-price-data"></a>
</h4>
<p>The function <code>prepare_price_data_long_WEOYYYY()</code> reads
price data based on the raw data format provided by IEA WEO and wrangles
that data into clean long format.The start year has to be set manually.
For fossil fuels, price data by scenario is derived from <strong>Ask
Antonio</strong>. For power generation, data on the levelized cost of
electricity (LCOE) by scenario is taken from <a href="https://www.iea.org/articles/levelised-cost-of-electricity-calculator" class="external-link uri">https://www.iea.org/articles/levelised-cost-of-electricity-calculator</a>
<strong>Ask Antonio</strong>. The function
<code><a href="../reference/prepare_lcoe_adjusted_price_data_weo.html">prepare_lcoe_adjusted_price_data_weo()</a></code> reads in the long
format prepared price data from IEA scenarios and filters LCOE for the
power sector. Using the LCOE for power generation implies that this
indicator must be transformed into effective prices for each company, by
applying the following transformation:</p>
<ul>
<li>LCOE = (1 - net_profit_margin) * price</li>
<li>price = LCOE / (1 - net_profit_margin)</li>
</ul>
<p>This transformation happens in <code>r2dii.cliamte.stress.test</code>
though, as it requires company level information.</p>
<p>We want to be able to use all data at least on a global granularity,
with additional layers of granularity being a nice-to-have. For some
variables, the raw data only contain a list of selected regional data.
In these cases, we approximate the global price as a simple arithmetic
mean of the regional prices. A more sophisticated approximation would
probably take into account the sizes of the markets and add some missing
regions, but for our purposes, this is still a reasonable approximation.
Specifically, we use this approximation for Coal and Gas extraction as
well as for all given types of power generation.</p>
</div>
<div class="section level4">
<h4 id="preparation-of-financial-data">Preparation of financial data<a class="anchor" aria-label="anchor" href="#preparation-of-financial-data"></a>
</h4>
<p>In order to obtain all relevant types of financial information for
the companies for which we have production data
(abcd_stress_test_input), we need to merge and clean the raw financial
data from Eikon with the companies data provided by Asset
Resolution.</p>
<p><code><a href="../reference/prepare_financial_data.html">prepare_financial_data()</a></code> requires the following inputs :
- <strong>financial_data</strong> the merge on isin between DB_ids and
DB_assets_eikon. Not all isin have to match a company_id, but the
highest the matching rate, the better quality will the output data be. -
<strong>companies_data</strong> DB_companies_activities. Brings the
information on missing company_id and ald_sector column. -
<strong>ownership_tree</strong> DB_ownership_tree -
<strong>minimum_sample_size</strong> minimum sample size tolerated to
use an average - <strong>minimum_ratio_sample</strong> minimum ratio of
a sample tolerated to use an average -
<strong>allowed_range_npm</strong> tolerated range for the net_profit
margin, c(min_npm, max_npm)</p>
<p><code><a href="../reference/prepare_financial_data.html">prepare_financial_data()</a></code> works by applying the following
steps : - Remove implausible values from the raw data, by setting the
cell where it appears to NA . Those values will be filled with averages
later on. - Using the country associated to each asset, map each country
to a world region. We’re not using the scenarios regions, because that
would create duplicate rows. - When a company owns several assets in
different countries, but same region, aggregate the financial indicators
from country to region. - Add new rows with NA financial value for the
missing company_id from companies_data. - If the ownership tree is
provided as an input, match missing financial values of subsidiaries to
their closest parent compahy, if the parent company has non-NA financial
values in the raw data. - Compute averages, and pick the most granular
one possible to fill missing values - As financial indicators are still
at the (company_id, ald_sector, region) granularity level, aggregate
those to the company level to be used in the stress test.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Antonio Buller, Bertrand Gallice.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
